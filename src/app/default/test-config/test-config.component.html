<mat-card>
  <mat-card-content fxLayoutAlign="center center">
    <mat-card-title>Point of Care Test Pathway Configuration</mat-card-title>
  </mat-card-content>
</mat-card>

<mat-tab-group>
  <mat-tab label="Create New">
    <div fxLayout="row wrap">
      <div fxFlex.gt-sm="50" fxFlex.xs="100" fxFlex="50">
        <form [formGroup]="newForm">
          <mat-card>
            <mat-card-content>
              <h5>Pathway Settings</h5>
              <mat-form-field class="example-full-width">
                <input autocomplete="off" matInput placeholder="Pathway Name" type="text" formControlName="test_pathway" />
              </mat-form-field>
              <mat-form-field class="example-full-width">
                <input autocomplete="off" matInput placeholder="Owner" type="text" formControlName="owner" />
              </mat-form-field>
              <mat-form-field class="example-full-width">
                <mat-select matInput placeholder="In Use" formControlName="in_use">
                  <mat-option value="'true'">Yes</mat-option>
                  <mat-option value="'false'">No</mat-option>
                </mat-select>
              </mat-form-field>
            </mat-card-content>
          </mat-card>

          <mat-card *ngIf="stepsData">
            <mat-card-content>
              <h5>Pathway Components</h5>

              <div formArrayName="steps">
                <mat-vertical-stepper>
                  <mat-step *ngFor="let steps of stepsData(newForm); let i = index" [formGroupName]="i" [label]="'Step ' + (i + 1)">
                    <mat-form-field class="example-full-width">
                      <input autocomplete="off" matInput placeholder="Component Type" type="text" formControlName="type" />
                      <mat-select matInput placeholder="Component Type" formControlName="type">
                        <mat-option *ngFor="let opt of component_types" [value]="opt.type">{{ opt.type }}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <mat-form-field class="example-full-width">
                      <input autocomplete="off" matInput placeholder="Order" type="number" formControlName="order" />
                    </mat-form-field>
                    <hr />

                    <div formArrayName="options">
                      <mat-card class="box-blue">
                        <mat-card-content>
                          <div *ngFor="let option of stepsOptionsData(steps); let j = index" [formGroupName]="j">
                            <mat-form-field class="example-half-width">
                              <input autocomplete="off" matInput placeholder="Key" type="text" formControlName="key" />
                            </mat-form-field>
                            <mat-form-field class="example-third-width">
                              <input autocomplete="off" matInput placeholder="Value" type="text" formControlName="value" />
                            </mat-form-field>
                            <button type="button" mat-raised-button color="warn" (click)="removeStepsOption(j, i)">Clear</button>
                          </div>
                          <button type="button" mat-raised-button (click)="addStepsOption(i)" style="float: right">Add Step Option</button>
                        </mat-card-content>
                      </mat-card>
                    </div>

                    <hr />
                    <button type="button" mat-raised-button class="btn-danger" style="width: 100%" (click)="removeSteps(i)">Remove this Component</button>
                    <hr />
                    <div>
                      <button type="button" *ngIf="i > 0" mat-raised-button matStepperPrevious type="button" style="width: 49%" color="primary">Back</button>
                      &nbsp;
                      <button type="button" *ngIf="stepsData(newForm).length > 1 && i < stepsData(newForm).length" mat-raised-button matStepperNext type="button" style="width: 49%" color="accent">Next</button>
                    </div>
                  </mat-step>
                </mat-vertical-stepper>
                <button type="button" mat-raised-button (click)="addSteps()" style="width: 100%">Add a Component</button>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card>
            <mat-card-content>
              <button type="button" mat-raised-button color="primary" (click)="previewForm(newForm.value)" style="width: 100%">Preview Pathway</button>
              <br /><br />
              <button type="button" mat-raised-button class="btn-danger" (click)="resetNewForm()" style="width: 100%">Clear</button>
            </mat-card-content>
          </mat-card>
        </form>
      </div>

      <div fxFlex.gt-sm="50" fxFlex.xs="100" fxFlex="50">
        <mat-card>
          <mat-card-content>
            <h5>Preview Pathway Settings</h5>
            <div *ngIf="!preview">Please complete configuration options</div>

            <div *ngIf="preview && preview.steps">
              <mat-card>
                <mat-card-content>
                  <h5>Config File</h5>
                  <span *ngIf="preview" [innerHTML]="transform(preview)"></span>
                </mat-card-content>
              </mat-card>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card *ngIf="preview">
          <mat-card-content>
            <button type="button" mat-raised-button color="primary" (click)="onSubmit(newForm.value)" style="width: 49%">Save Form</button>
            &nbsp;
            <button type="button" mat-raised-button color="warn" (click)="resetNewForm()" style="width: 49%">Clear</button>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </mat-tab>

  <mat-tab *ngFor="let form of formArray" [label]="form.test_pathway">
    <app-view-pathway [selectedPathway]="form" (editPathway)="editPathway($event)"></app-view-pathway>
  </mat-tab>
</mat-tab-group>
